{% if locale.language === 'en' %}
<script>

    window.language = 'en';
</script>
{% endif %}
{% if locale.language === 'de' %}
<script>
    window.language = 'de';
</script>
{% endif %}
{% if locale.language === 'zh' %}
<script>
    window.language = 'cn';
</script>
{% endif %}

<script>
    $(document).ready(function () {
        enhance();
        prepareForm();
        formAutocomplete();
        setTimeout(showcontent, 500);
        setTimeout(removeloading, 1000);
        setTimeout(onLoaded, 1005);
    });

    function showcontent() {
        $('.dit-outer-wrap').show();
    }

    function removeloading() {
        $('.dit-loading').fadeOut(300);
    }

    function enhance() {
        enhance_videobg();
        // zoomImageHoverLink();
    }

    function enhance_videobg() {
        if ($('#bgVid').length > 0 || $('#bgImg').length > 0) {
            $('.jumbotron').addClass('bg--transparent');
        }
    }

    function onLoaded() {
        smoothScroll();
        addActive();
        checkHeight();
        checkFormStatus();
    }

    function smoothScroll() {
        //smoothscrolling and positioning
        $('a[href^="#"]').on('click', function (e) {
            // prevent default anchor click behavior
            e.preventDefault();
            // store hash
            var hash = this.hash;
            // animate
            $('html, body').stop().animate({
                scrollTop: $(hash).offset().top
            }, 600, 'swing', function () {
                window.location.hash = hash;
            });
        });
    }

    function addActive() {
        var url = window.location.pathname;
        var language = url.match(/\/\w{2}\//);
        var child = '';
        if (url.match(/\/industries\//)) {
            child = 'industries/';
        } else if (url.match(/\/investment-guide\//)) {
            child = 'investment-guide/';
//        } else if (url.match('\/help\/')) {
//            child = 'help/';
        } else if (url.match(/\/\w{2}\/$/)) {
            child = '';
        }

        if ($('ul.nav a')) {
            $('ul.nav a[href="' + language[0] + child + '"]').parent().addClass('active');
        }
    }

    function checkHeight() {

        var elem = $('div').find('.check-height');
        if (elem.length > 0) {
            equalheight(elem);
        }
    }

    function checkFormStatus(){
        var field = 'enquiryId';
        var url = window.location.href;
        var formLeftSide = $('.dit-form-section__info');
        var formRightSide = $('.dit-form-section__body');
        var formSuccess = $('#formSuccess');
        var enquiryId = $('#enquiry_Id');
        if(url.indexOf('?' + field + '=') != -1){

            formLeftSide.hide();
            formRightSide.hide();
            formSuccess.show();
            $('html, body').animate({
                scrollTop: $('.dit-form-section').offset().top
            }, 2000);
            console.log('here');
            enquiryId.text(getUrlVar());
        }else{
            if(url.indexOf('&' + field + '=') != -1){
            formLeftSide.hide();
            formRightSide.hide();
            formSuccess.show();
            $('html, body').animate({
                scrollTop: formSuccess.offset().top
            }, 2000);           
            enquiryId.text(getUrlVar());
        }
    }
}

function getUrlVar(){

    var id, hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++){
        hash = hashes[i].split('=');
        id = hash[1];
    }
    return "IIGB-"+id;
}

    function prepareForm() {
        var navListItems = $('div.setup-panel div a'),
                allWells = $('.setup-content'),
                allNextBtn = $('.nextBtn'),
                allPrevBtn = $('.prevBtn'),
                submitBtn = $('.submitBtn'),
                locationSelectors = $('#location_selectors'),
                locationRadioYes = $('#location_radio_yes'),
                locationRadioNo = $('#location_radio_no');
        allWells.hide();
        locationSelectors.hide();

        locationRadioYes.click(
                function (e) {
                    locationSelectors.show();
                });

        locationRadioNo.click(
                function (e) {
                    $('#location').prop('selectedIndex', 0);
                    locationSelectors.hide();
                });

        $('#step-2').on('click', '.radio-group a', function() {
            var sel = $(this).data('title');
            var tog = $(this).data('toggle');
            $(this).parent().next('.' + tog).prop('value', sel);
            $(this).parent().find('a[data-toggle="' + tog + '"]').not('[data-title="' + sel + '"]').removeClass('active').addClass('notActive');
            $(this).parent().find('a[data-toggle="' + tog + '"][data-title="' + sel + '"]').removeClass('notActive').addClass('active');
        });

        navListItems.click(function (e) {
            e.preventDefault();
            var $target = $($(this).attr('href')),
                    $item = $(this);

            if (!$item.hasClass('disabled')) {
                navListItems.removeClass('active-selection');
                $item.addClass('active-selection');
                allWells.hide();
                $target.show();
                $target.find('input:eq(0)').focus();
            }
        });

        allNextBtn.click(function () {
            var curStep = $(this).closest(".setup-content"),
                    curStepBtn = curStep.attr("id"),
                    nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
                    curInputs = curStep.find("input[type='text'],input[type='email'], #location_radio_yes, #turnover, #country, #industry, #start_date_month, #start_date_year, #staff,input[type='date']"),
                    isValid = true;

            $(".form-group").removeClass("has-error");
            for (var i = 0; i < curInputs.length; i++) {
                if (curInputs[i].hasAttribute('required') && curInputs[i].value === '') {  //changed for IE8 compatibility
                    isValid = false;
                    $(curInputs[i]).closest(".form-group").addClass("has-error");
                }
            }

            if (isValid)
                nextStepWizard.removeAttr('disabled').trigger('click');
        });

        allPrevBtn.click(function () {
            var curStep = $(this).closest(".setup-content"),
                    curStepBtn = curStep.attr("id"),
                    prevStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().prev().children("a"),
                    curInputs = curStep.find("input[type='text'],input[type='email'], #turnover:selected, #staff:selected, #country:selected, #location:selected"),
                    isValid = true;

            if (isValid)
                prevStepWizard.removeAttr('disabled').trigger('click');
        });

        $('div.setup-panel div a.active-selection').trigger('click');
    }


    function formAutocomplete(){

    var countries = [
                {% for o in labels.form_headquarters.options %} 
                {"value": "{{o}}", "data": "{{loop.index}}"},
                {% endfor %}];

  var countries_en = ["zero",
                {% for o in labels.en.form_headquarters.options %} 
                "{{o}}",
                {% endfor %}];

$('#country').autocomplete({
    lookup: countries,
    onSelect: function (suggestion) {
        $('#country_en').val(countries_en[suggestion.data]);
    }
});
}
    

    $(window).on('resize', function () {
        checkHeight();
    });
</script>

